<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Trucadas</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Monomaniac+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha384-..." crossorigin="anonymous">
    <link rel="icon" href="https://i.imgur.com/40z3ABN.png" type="image/png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #2c2c2c;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            height: 100vh;
            background-size: cover;
            background-repeat: no-repeat;
            touch-action: manipulation;
            padding: 60px;
            overflow-y: hidden;
        }

        h1 {
            font-family: 'Monomaniac One', sans-serif;
            font-size: 30px;
            color: #ffffff;
            text-shadow: 3px 3px 5px #000;
            margin: 20px 0;
            text-align: center;
        }

        .container {
            position: relative;
            font-family: 'Poppins', sans-serif;
            text-align: center;
            background: 
                linear-gradient(160deg, #2a2a2a 0%, #202020 100%),
                repeating-linear-gradient(
                    45deg,
                    rgba(255, 71, 71, 0.1) 0px,
                    rgba(255, 71, 71, 0.1) 20px,
                    transparent 20px,
                    transparent 40px
                );
            border: 1px solid #1c1c1c;
            border-bottom: 5px solid #1c1c1c;
            padding: 25px;
            border-radius: 24px;
            width: 400px;
            overflow: hidden;
        }

        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.05), transparent 70%);
            animation: pulse 6s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .scoreboard {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .scoreboard::after {
            content: "";
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            height: 85%;
            width: 2px;
            background: linear-gradient(
                180deg,
                rgba(164, 164, 164, 0.178),
            );
            border-radius: 2px;
        }

        .dupla {
            flex: 1;
            text-align: center;
            font-size: 36px;
        }

        .dupla h2 {
            margin-bottom: 10px;
            font-size: 24px;
            color: #ffffff;
        }

        .dupla div {
            font-size: 48px;
            font-weight: bold;
        }

        .controls {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }

        .controls button {
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 24px;
            margin: 0 10px;
            padding: 5px 15px;
        }

        .truco-btn {
            font-family: 'Monomaniac One', sans-serif;
            padding: 15px 55px;
            background-color: #828282;
            border: 1px solid #4f4f4f;
            border-bottom: 4px solid #4f4f4f;
            border-radius: 18px;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s ease;
        }

        .truco-btn:hover {
            background-color: #5a5a5a;
        }

        .truco-btn:active {
            transform: translateY(1px) scale(0.98);
            transition: 0.2s;
        }

        .vitorias {
            display: flex;
            justify-content: space-between;
            font-size: 20px;
            color: #fff;
            margin-top: 20px;
        }

        .vitorias span {
            font-size: 18px;
        }

        .vitorias i {
            font-size: 15px;
            background: none !important;
        }

        .rank-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-80%);
            filter: none !important;
            text-shadow: none !important;
        }

        .rank-icon.left {
            right: 100%;
            margin-right: -55px;
        }

        .rank-icon.right {
            left: 100%;
            margin-left: -55px;
        }

        .rank-icon i.fa-medal {
            font-size: 12px;
            opacity: 0.9;
        }

        .rank-icon i.fa-medal.bronze { color: #cd7f32; }
        .rank-icon i.fa-medal.prata { color: #C0C0C0; }
        .rank-icon i.fa-medal.ouro { color: #FFD700; }
        .rank-icon i.fa-medal.diamante { color: #5ae1ff; }
        .rank-icon i.fa-medal.mitico { color: #8a2be2; }


        .rank-icon i.fa-medal.pro-rank { animation: pro-gradient-cor 3s ease infinite; }

        @keyframes pro-gradient-cor {
            0% {
                color: #b1ff33;
            }
            25% {
                color: #00ff00;
            }
            50% {
                color: #00dc54;
            }
            75% {
                color: #00ff00;
            }
            100% {
                color: #b1ff33;
            }
        }

        .rank-icon i.fa-medal.mestre1-rank { animation: fogo-mestre-cor 3s ease infinite; }

        @keyframes fogo-mestre-cor {
            0% {
                color: #ff2020;
            }
            25% {
                color: #ff4500;
            }
            50% {
                color: #ff2200;
            }
            75% {
                color: #ff6b00;
            }
            100% {
                color: #ff2020;
            }
        }

        .rank-icon i.fa-medal.mestre2-rank { animation: fogo-mestre-cor2 3s ease infinite; }

        @keyframes fogo-mestre-cor2 {
            0% {
                background-color: #850000;
            }
            25% {
                background-color: #890000;
            }
            50% {
                background-color: #a50000;
            }
            75% {
                background-color: #890000;
            }
            100% {
                background-color: #850000;
            }
        }

        .mensagem-vitoria {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(160deg, #292929 0%, #1e1e1e 100%);
            border: 1px solid #1c1c1c;
            border-bottom: 4px solid #1c1c1c;
            color: #fff;
            padding: 45px 65px;
            border-radius: 24px;
            text-align: center;
            z-index: 1000;
            overflow: hidden;
            max-width: 90%;
            font-family: 'Poppins', sans-serif;
            backdrop-filter: blur(10px);
        }

        .mensagem-vitoria::before {
            content: "üèÜ";
            position: absolute;
            font-size: 130px;
            opacity: 0.1;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: -1;
        }

        .mensagem-vitoria h2 {
            margin: 0;
            line-height: 1.4;
            font-size: 22px;
            color: #ffd700;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.6),
                0 0 10px rgba(84, 84, 84, 0.164);
            margin-bottom: 15px;
        }

        .mensagem-vitoria p {
            font-size: 18px;
            margin: 20px 0;
            color: #fcd163;
        }


        .mensagem-vitoria button {
            background: 
                linear-gradient(145deg, #9e9e9e, #bcbcbc);
                font-family: 'Monomaniac One', sans-serif;
            border: 1px solid #676767;
            border-bottom: 4px solid #676767;
            border-radius: 12px;
            padding: 15px 40px;
            font-size: 20px;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-top: 25px;
        }

        .mensagem-vitoria button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            transform: rotate(45deg);
            animation: brilho 3s infinite;
        }

        .mensagem-vitoria button:active {
            transform: scale(0.95);
        }

        @keyframes aparecer {
            0% {
                opacity: 0;
                transform: translate(-50%, -60%) scale(0.8);
                filter: blur(10px);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
                filter: blur(0);
            }
        }

        @keyframes brilho {
            0% { left: -150%; }
            100% { left: 150%; }
        }

        .historico-container {
            display: none;
            background: rgba(25, 25, 25, 0.95);
            padding: 16px;
            border-radius: 12px;
            margin-top: 8px;
            max-height: 80px;
            overflow-y: auto;
            position: relative;
            font-size: 10px;
            -ms-overflow-style: none;
        }

        .historico-container::-webkit-scrollbar {
            display: none;
        }

        .historico-container p {
            margin: 6px 0;
            padding: 5px 0;
            color: rgba(255, 255, 255, 0.75);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 500;
        }

        .historico-btn {
            display: none;
            background: rgb(66, 66, 66);
            border: 1px solid #282828;
            border-bottom: 3px solid #282828;
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            padding: 7px 14px;
            margin-top: 12px;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.2s ease;
            font-weight: 600;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .historico-btn:hover {
            background: rgb(76, 76, 76);
            color: rgba(220, 220, 220, 0.9);
        }

        .historico-btn:active {
            transform: scale(0.96);
        }


        .limpar-historico-btn {
            position: absolute;
            top: 5px;
            right: 8px;
            background: none;
            border: none;
            color: rgba(255, 71, 71, 0.4);
            font-size: 14px;
            cursor: pointer;
            padding: 2px;
            transition: all 0.2s ease;
        }

        .limpar-historico-btn:hover {
            color: rgba(255, 71, 71, 0.8);
        }

        .limpar-historico-btn:active {
            transform: scale(0.9);
        }

                .editar-nome {
            cursor: pointer;
            margin-left: 10px;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .editar-nome:hover {
            color: #b3b3b3;
        }

        .nome-dupla {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-decrementar, .btn-incrementar {
            background: #828282;
            border: 1px solid #4e4e4e;
            border-bottom: 3px solid #4e4e4e;
            border-radius: 5px;
            padding: 12px 20px;
            font-size: 18px;
            color: white;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .btn-decrementar:hover, .btn-incrementar:hover {
            background: #5a5a5a;
        }

        .btn-decrementar:active, .btn-incrementar:active {
            transform: scale(0.93);
        }

        .btn-icon {
            font-size: 19px;
            color: white;
            transition: transform 0.2s ease;
        }

        .btn-decrementar:hover .btn-icon, .btn-incrementar:hover .btn-icon {
            transform: scale(1.1);
        }

        .level-bar {
            position: relative;
            font-size: 8px;
            color: #fff;
            gap: 5px;
        }

        .xp-container {
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            height: 13px;
            border-radius: 5px;
            overflow: hidden;
            margin: 0 auto; 
            margin-bottom: 5px;
            margin-top: -35px;
            width: 50%;
        }

        .xp-bar {
            height: 100%;
            border-radius: 5px;
            transition: width 0.3s ease;
            position: absolute;
            background-size: 400% 400%;
            pointer-events: none;
            background: linear-gradient(90deg, #00619d, #008197, #00a690, #00a2bf, #0087db); 
            animation: xpAnimation 5s infinite alternate, slimePulse 2s infinite alternate;;
        }

        @keyframes xpAnimation {
            0% {
                background: #00619d;
            }
            25% {
                background: #008197;
            }
            50% {
                background: #00a690;
            }
            75% {
                background: #00a2bf;
            }
            100% {
                background: #0087db;
            }
        }

        @keyframes slimePulse {
            0% {
                filter: blur(1px) brightness(1);
            }
            100% {
                filter: blur(3px) brightness(1.3);
            }
        }

        .xp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 9px;
            color: #fff !important;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6);
            white-space: nowrap;
            z-index: 10;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        #dupla1-level {
            font-size: 11px;
            font-weight: 600;
            color: #fff;
            padding: 2px 8px;
            border-radius: 5px;
            display: inline-block;
            top: 30px;
            transform: translateY(-165%);
            width: auto;
            min-width: 48px;
            height: 20px;
            text-align: center;
        }

        #dupla2-level {
            font-size: 11px;
            font-weight: 600;
            color: #fff;
            padding: 2px 8px;
            border-radius: 5px;
            display: inline-block;
            top: 30px;
            transform: translateY(-165%);
            width: auto;
            min-width: 48px;
            height: 20px;
            text-align: center;
        }

        #dupla1-nome {
            color: #009dff;
        }

        #dupla2-nome {
            color: #f4000c;
        }

        .rank-tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: auto;
            padding: 0;
            margin: 0;
        }

        .tooltip-text {
            visibility: hidden;
            background-color: rgba(0, 0, 0, 0.432);
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 2px 9px;
            position: absolute;
            z-index: 1;
            bottom: 98%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s ease;
            font-size: 9px;
            white-space: nowrap;
            pointer-events: none;
        }

        .rank-tooltip:active .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        @keyframes pro-gradient {
            0% {
                background-color: #b1ff33;
            }
            25% {
                background-color: #00ff00;
            }
            50% {
                background-color: #00dc54;
            }
            75% {
                background-color: #00ff00;
            }
            100% {
                background-color: #b1ff33;
            }
        }

        .pro-rank {
            animation: pro-gradient 3s ease infinite;
        }

        @keyframes fogo-mestre1 {
            0% {
                background-color: #ff2020;
            }
            25% {
                background-color: #ff4500;
            }
            50% {
                background-color: #ff2200;
            }
            75% {
                background-color: #ff6b00;
            }
            100% {
                background-color: #ff2020;
            }
        }

        @keyframes fogo-mestre2 {
            0% {
                background-color: #850000;
            }
            25% {
                background-color: #890000;
            }
            50% {
                background-color: #a50000;
            }
            75% {
                background-color: #890000;
            }
            100% {
                background-color: #850000;
            }
        }

        .mestre1-rank {
        animation: fogo-mestre1 3s ease infinite;
        }

        .mestre2-rank {
            animation: fogo-mestre2 3s ease infinite;
        }

        #dupla1-tentos {
            font-family: 'Monomaniac One', sans-serif;
        }

        #dupla2-tentos {
            font-family: 'Monomaniac One', sans-serif;
        }

        .desafio-item {
            margin: 8px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: transform 0.2s ease, background 0.3s ease;
        }

        .desafio-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .desafio-info {
            display: grid;
            grid-template-columns: 22px 1fr auto;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #ddd;
        }

        .desafio-info i {
            font-size: 1.1em;
            color: #2196F3;
            transition: color 0.3s ease;
        }

        .completo .desafio-info i {
            color: #4CAF50;
        }

        .progresso-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.07);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .progresso {
            height: 100%;
            background: linear-gradient(90deg, #2196F3, #0d47a1);
            transition: width 0.4s ease-in-out;
            border-radius: 8px;
        }

        .completo .progresso {
            background: linear-gradient(90deg, #4CAF50, #2E7D32);
        }

        .progresso-texto {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            color: #f5f5f5;
            font-size: 10px;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
        }

        .btn-desafios {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: white;
            font-size: 16px;
            border: none;
            background: none;
            cursor: pointer;
            transition: transform 0.2s ease;
            z-index: 1000;
        }

        .btn-desafios:hover {
            transform: scale(1.1);
        }

        .btn-desafios:active {
            transform: scale(1);
        }

        .desafios-popup {
            display: none;
            position: fixed;
            bottom: 65px;
            right: 25px;
            width: 320px;
            background: linear-gradient(145deg, #252525, #1a1a1a);
            border-radius: 20px;
            z-index: 1001;
            border: 1px solid #1c1c1c;
            border-bottom: 4px solid #1c1c1c;
            backdrop-filter: blur(8px);
            overflow: hidden;
        }

        .desafios-popup.active {
            display: block;
            animation: fadeSlideIn 0.4s ease-out;
        }

        @keyframes fadeSlideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .desafios-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .desafios-header i {
            margin-right: 10px;
            color: #f7f7f7;
            font-size: 14px;
            transition: color 0.3s;
        }

        .fechar-popup {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 23px;
            height: 23px;
            background: none;
            border: none;
            border-radius: 7px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease, transform 0.2s ease;
            z-index: 2;
        }

        .fechar-popup:hover {
            background: #ff4d4d;
        }

        .fechar-popup:active {
            transform: scale(0.9);
        }

        .fechar-popup::after {
            content: '√ó';
            font-size: 1.4em;
            color: white;
        }

        .desafios-content {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .timer-atualizacao {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0;
            font-size: 12px;
            color: #cecece;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: background 0.3s ease;
        }

        .timer-atualizacao i {
            margin-right: 6px;
            font-size: 14px;
            color: #0070c0;
            animation: girar 1.5s linear infinite;
        }

        @keyframes girar {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .msgac {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: none;
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 16px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease-in-out, top 0.5s ease-in-out;
            z-index: 9999;
        }

        .msgac.show {
            opacity: 1;
            top: 30px;
        }

        .msgac.hide {
            opacity: 0;
            top: 20px;
        }

        .msgac i {
            color: #4CAF50;
        }

        .fa-trophy {
            color: #ffdd1f;
            transition: color 0.3s ease;
        }

        .btn-config {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: white;
            font-size: 16px;
            border: none;
            background: none;
            cursor: pointer;
            transition: transform 2s ease;
            z-index: 1000;
        }

        .config-popup {
            display: none;
            position: fixed;
            bottom: 65px;
            left: 25px;
            width: 320px;
            background: linear-gradient(145deg, #252525, #1a1a1a);
            border-radius: 20px;
            z-index: 1001;
            border: 1px solid #1c1c1c;
            border-bottom: 4px solid #1c1c1c;
            backdrop-filter: blur(8px);
            overflow: hidden;
        }

        .config-popup.active {
            display: block;
            animation: fadeSlideIn 0.4s ease-out;
        }

        .config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .config-header i {
            margin-right: 10px;
            color: #ffffff;
            font-size: 14px;
            transition: transform 2s ease;
        }

        .config-header i:hover {
            cursor: pointer;
            transform: rotate(360deg);
        }

        .config-content {
            padding: 15px;
        }

        .btn-patch {
            position: fixed;
            bottom: 20px;
            left: 70px;
            color: white;
            font-size: 16px;
            border: none;
            background: none;
            cursor: pointer;
            transition: transform 0.2s ease;
            z-index: 1000;
        }

        .btn-patch:hover {
            transform: scale(1.1);
        }

        .patch-popup {
            display: none;
            position: fixed;
            bottom: 80px;
            left: 20px;
            width: 320px;
            background: linear-gradient(145deg, #202020, #1a1a1a);
            border-radius: 20px;
            z-index: 1001;
            border: 1px solid #1c1c1c;
            border-bottom: 4px solid #1c1c1c;
            backdrop-filter: blur(10px);
            overflow: hidden;
            overflow-y: auto;
        }

        .patch-popup.active {
            display: block;
            animation: fadeSlideIn 0.3s ease-out;
        }

        .patch-content {
            padding: 12px;
            max-height: 43vh;
            overflow-y: auto;
            font-size: 12px;
            line-height: 1.4;
        }

        .patch-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .patch-header i {
            margin-right: 10px;
            color: #f7f7f7;
            font-size: 14px;
            transition: color 0.3s;
        }

        .patch-item {
            margin: 8px 0;
            padding: 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 14px;
            transition: all 0.2s ease;
        }

        .patch-version {
            color: #5e9cdf;
            font-weight: 700;
            margin-bottom: 4px;
            font-size: 13px;
            letter-spacing: 0.5px;
        }

        .patch-date {
            color: rgba(255,255,255,0.4);
            font-size: 0.65em;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
        }

        .patch-item ul {
            padding-left: 16px;
            margin: 4px 0;
        }

        .patch-item li {
            list-style: none;
            margin-bottom: 3px;
            color: rgba(255, 255, 255, 0.8);
            position: relative;
            padding-left: 16px;
        }

        .patch-item li:before {
            content: '‚ñ∫';
            color: #39ccea;
            font-size: 0.8em;
            position: absolute;
            left: 0;
            top: 1px;
        }

        .patch-content::-webkit-scrollbar {
            width: 5px;
        }

        .patch-content::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
        }

        .patch-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }

        .versao-programa {
            position: fixed;
            top: 20px;
            right: 20px;
            color: rgba(255,255,255,0.3);
            font-size: 12px;
            font-family: monospace;
        }

        .tema-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 7px 0;
            background-color: #262626;
            border-radius: 15px;
            border: 1px solid #1c1c1c;
            border-bottom: 4px solid #1c1c1c;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tema-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .tema-preview {
            width: 39px;
            height: 39px;
            border-radius: 8px;
            margin-right: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .tema-preview.classico {
            background: linear-gradient(160deg, #404040, #303030);
            border: 2px solid #ff3333;
        }

        .tema-preview.new {
            background: linear-gradient(160deg, #2a2a2a 0%, #202020 100%);
        }

        .tema-preview.dark {
            background: linear-gradient(160deg, #2a2a2a, #1e1e1e);
            border: 2px solid #161616;
        }

        .tema-preview.blue {
            background: linear-gradient(160deg, #2a2a2a, #1e1e1e);
            border: 2px solid #0049a8;
        }

        [data-theme="blue"] body {
            background-color: #1e1e1e;
            color: #e0e0e0;
        }

        [data-theme="blue"] .container {
            background: linear-gradient(160deg, #2e2e2e, #272727) !important;
            color: #e0e0e0;
            border: 1px solid #1c1c1c;
            border-bottom: 4px solid #1c1c1c;
        }

        [data-theme="blue"] .btn-decrementar,
        [data-theme="blue"] .btn-incrementar {
            background: linear-gradient(145deg, #006bc9, #00599e);
            color: #e0e0e0;
            border: 1px solid #002b54;
            border-bottom: 3px solid #002b54;
        }

        [data-theme="blue"] .truco-btn {
            background-color: #005198;
            color: #e0e0e0;
            border: 1px solid #002b54;
            border-bottom: 3px solid #002b54;
        }

        [data-theme="blue"] .truco-btn:hover {
            background-color: #00599e;
        }

        [data-theme="blue"] .xp-bar {
            background: linear-gradient(90deg, 
                #00599e, 
                #0077d1, 
                #0080e1, 
                #0078d3, 
                #00599e);
            background-size: 200% 200%;
            animation: xpSlide 4s linear infinite alternate;
        }

        [data-theme="dark"] body {
            background-color: #1e1e1e;
            color: #e0e0e0;
        }

        [data-theme="dark"] .container {
            background: linear-gradient(160deg, #161616, #1a1a1a) !important;
            color: #e0e0e0;
            border: 1px solid #080808;
            border-bottom: 3px solid #080808;
        }

        [data-theme="dark"] .btn-decrementar,
        [data-theme="dark"] .btn-incrementar {
            background: linear-gradient(145deg, #3c3c3c, #4f4f4f);
            color: #e0e0e0;
        }

        [data-theme="dark"] .truco-btn {
            background-color: #333;
            color: #e0e0e0;
        }

        [data-theme="dark"] .truco-btn:hover {
            background-color: #414141;
        }

        [data-theme="dark"] .xp-bar {
            background: linear-gradient(90deg, 
                #848484, 
                #696969, 
                #898989, 
                #858585, 
                #6b6b6b);
            background-size: 200% 200%;
            animation: xpSlide 4s linear infinite alternate;
        }

        @keyframes xpSlide {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        [data-theme="classico"] .container {
            background: linear-gradient(160deg, #303030, #252525) !important;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        [data-theme="classico"] .btn-decrementar,
        [data-theme="classico"] .btn-incrementar {
            background: linear-gradient(145deg, #ff4444, #cc0000) !important;
        }

        [data-theme="classico"] .truco-btn {
            background-color: #cc0000 !important;
        }

        [data-theme="classico"] .truco-btn:hover {
            background-color: #980000 !important;
        }

        .checkbox-micro {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 6px;
            border-radius: 5px;
            transition: background 0.3s ease;
            pointer-events: none;
        }

        .checkbox-micro input {
            opacity: 0;
            position: absolute;
            cursor: pointer;
            pointer-events: auto;
        }

        .checkbox-micro input {
            opacity: 0;
            position: absolute;
        }

        .checkbox-micro .checkmark {
            position: relative;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 5px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
        }

        .checkbox-micro input:checked ~ .checkmark {
            background: rgba(0, 165, 231, 0.9);
            border-color: rgba(0, 165, 231, 0.9);
        }

        .checkbox-micro .checkmark i {
            font-size: 12px;
            color: white;
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.3s ease;
        }

        .checkbox-micro input:checked ~ .checkmark i {
            opacity: 1;
            transform: scale(1);
        }

        .btn-reset-danger {
            background: rgba(59, 59, 59, 0.2);
            border-radius: 10px;
            border: 2px solid #9f9f9f;
            color: #f9f6f6;
            font-size: 15px;
            cursor: pointer;
            padding: 7px;
            transition: all 0.3s ease;
        }

        .btn-reset-danger:hover {
            color: #ff3434;
            border: 2px solid #ff0000;
        }

        .btn-reset-danger:active {
            transform: scale(0.9);
        }

        .config-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .reset-dialog {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 9999;
        }

        .reset-content {
            position: relative;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a1a;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #ff0000;
            box-shadow: 0 0 25px rgba(255,0,0,0.3);
            width: 320px;
            text-align: center;
            animation: pulse-alert 1s infinite;
        }

        @keyframes pulse-alert {
            0% { border-color: #ff0000; }
            50% { border-color: #ff4444; }
            100% { border-color: #ff0000; }
        }

        .reset-header {
            color: #ff0000;
            margin-bottom: 15px;
        }

        .theme-accordion {
            margin-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            cursor: pointer;
            user-select: none;
        }

        .arrow-icon {
            transition: transform 0.3s ease;
            font-size: 0.9em;
        }

        .theme-options {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .theme-options.open {
            max-height: 300px;
        }

        .arrow-icon.rotated {
            transform: rotate(180deg);
        }

        .reset-dialog {
            background: rgba(0,0,0,0.85);
        }

        .reset-content {
            background: #2a2a2a;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 25px;
            animation: none;
        }

        .reset-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        .reset-buttons button {
            font-family: 'Monomaniac One', sans-serif;
            text-transform: uppercase;
            border: none;
            padding: 12px 30px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .reset-buttons button.confirm-btn {
            background: #e53935;
        }

        .reset-buttons button:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .reset-buttons button:active {
            transform: translateY(0);
        }

        [data-theme="classico"] .mensagem-vitoria {
            background: linear-gradient(160deg, #cc0000b2, #990000ad) !important;
            border: 2px solid #ff4444;
        }

        [data-theme="classico"] .mensagem-vitoria h2 {
            color: #ffffff;
        }

        [data-theme="classico"] .mensagem-vitoria button {
            background: linear-gradient(145deg, #ff4444, #cc0000) !important;
        }

        [data-theme="new"] .mensagem-vitoria {
            background: linear-gradient(160deg, #2a2a2a 0%, #202020 100%) !important;
            border: 1px solid rgba(255, 71, 71, 0.3);
        }

        [data-theme="new"] .mensagem-vitoria h2 {
            color: #ff3333;
        }

        [data-theme="dark"] .mensagem-vitoria {
            background: linear-gradient(160deg, #1a1a1a, #000000) !important;
            border: 1px solid #333;
        }

        [data-theme="dark"] .mensagem-vitoria h2 {
            color: #e0e0e0;
        }

        [data-theme="dark"] .mensagem-vitoria p {
            color: #b0b0b0;
        }

        [data-theme="blue"] .mensagem-vitoria {
            background: linear-gradient(160deg, #004a8f, #002b54) !important;
            border: 1px solid #0078d4;
        }

        [data-theme="blue"] .mensagem-vitoria h2 {
            color: #80d4ff;
        }

        [data-theme="blue"] .mensagem-vitoria button {
            background: linear-gradient(145deg, #0078d4, #0063ad) !important;
        }

        .modal-editar-nome {
            font-family: 'Poppins', sans-serif;
            text-transform: uppercase;
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-conteudo {
            background: #2a2a2a;
            padding: 25px;
            border-radius: 12px;
            width: 280px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .modal-conteudo h3 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.2em;
            text-align: center;
        }

        #novoNomeInput {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            background: #404040;
            border: 1px solid #555;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
            text-align: center;
            outline: none;
        }

        .modal-botoes {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .modal-botoes button {
            font-family: 'Monomaniac One', sans-serif;
            text-transform: uppercase;
            padding: 8px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .modal-botoes button:first-child {
            background: #138e00;
            color: white;
        }

        .modal-botoes button:last-child {
            background: #9b0000;
            color: white;
        }

        .modal-botoes button:hover {
            opacity: 0.9;
        }

    </style>
</head>
<body>
    <div id="msgac" class="msgac"><i class="fas fa-check-circle"></i>  Nome alterado</div>
    <h1 style="display: flex; align-items: center;">
        TRUCADAS
    </h1>

    <div class="container">
        <div class="scoreboard">
            <div class="dupla">              
                <div class="level-bar">
                    <div class="rank-icon left">
                        <i class="fa-solid fa-medal"></i>
                      </div>
                    <div class="rank-tooltip">
                        <span id="dupla1-level" onclick="mostrarTooltip('dupla1')">Lv 0</span>
                        <span class="tooltip-text" id="dupla1-tooltip"></span>
                    </div>
                    <div class="xp-container">
                        <div class="xp-bar" id="dupla1-xp-bar"></div>
                        <span class="xp-text" id="dupla1-xp-text"></span>
                    </div>
                </div>
                <div class="nome-dupla">
                    <h2 id="dupla1-nome">N√ìS</h2>
                    <i class="fa-solid fa-pencil editar-nome" onclick="editarNome('dupla1')"></i>
                </div>
                <div id="dupla1-tentos">0</div>
                <div class="controls">
                    <button class="btn-decrementar" onclick="decrementarPontos('dupla1')">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                    <button class="btn-incrementar" onclick="incrementarPontos('dupla1')">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    </button>
                </div>
            </div>
            
            <div class="dupla">              
                <div class="level-bar">
                    <div class="rank-icon right">
                        <i class="fa-solid fa-medal"></i>
                      </div>
                    <div class="rank-tooltip">
                        <span id="dupla2-level" onclick="mostrarTooltip('dupla2')">Lv 0</span>
                        <span class="tooltip-text" id="dupla2-tooltip"></span>
                    </div>
                    <div class="xp-container">
                        <div class="xp-bar" id="dupla2-xp-bar"></div>
                        <span class="xp-text" id="dupla2-xp-text"></span>
                    </div>
                </div>
                <div class="nome-dupla">
                    <h2 id="dupla2-nome">ELES</h2>
                    <i class="fa-solid fa-pencil editar-nome" onclick="editarNome('dupla2')"></i>
                </div>
                <div id="dupla2-tentos">0</div>
                <div class="controls">
                    <button class="btn-decrementar" onclick="decrementarPontos('dupla2')">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                    <button class="btn-incrementar" onclick="incrementarPontos('dupla2')">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="vitorias">
            <span><i class="fas fa-trophy"></i> <span id="dupla1-vitorias">0</span></span>
            <span><span id="dupla2-vitorias">0</span> <i class="fas fa-trophy"></i></span>
        </div>

        <button class="truco-btn" onclick="ativarTruco()">TRUCO (<span id="truco-pontos">0</span> tentos)</button>

        <button class="historico-btn" onclick="toggleHistorico()">Hist√≥rico</button>
        
        <div class="historico-container" id="historico-container">
            <button class="limpar-historico-btn" onclick="limparHistorico()">
                <i class="fas fa-trash-alt"></i>
            </button>
        </div>
    </div>

    <div class="mensagem-vitoria" id="mensagem-vitoria">
        <h2 id="ganhador"></h2>
        <button onclick="reiniciarJogo()">Recome√ßar</button>
    </div>

    <button class="btn-desafios" onclick="toggleDesafios()">
        <i class="fas fa-tasks"></i>
    </button>
    
    <div id="desafios-popup" class="desafios-popup">
        <div class="desafios-header">
            <h3><i class="fas fa-calendar-day"></i> Desafios di√°rios</h3>
            <button class="fechar-popup" onclick="toggleDesafios()"></button>
        </div>
        <div id="desafios-list" class="desafios-content"></div>
        <div class="timer-atualizacao">
            <i class="fas fa-sync-alt"></i>
            <span id="timer-desafios">00h00m00s</span>
        </div>
    </div>

    <button class="btn-config" onclick="toggleSettings()">
        <i class="fas fa-cog"></i>
    </button>
    
    <div id="config-popup" class="config-popup">
        <div class="config-header">
            <h3><i class="fas fa-cog"></i> Configura√ß√µes</h3>
            <button class="fechar-popup" onclick="toggleSettings()"></button>
        </div>
        <div class="config-content">
            <div class="config-row">
                <label class="checkbox-micro check-hist">
                    <input type="checkbox" id="historico-check">
                    <span class="checkmark">
                        <i class="fas fa-check"></i>
                    </span>
                        Hist√≥rico
                </label>

                <button class="btn-reset-danger" onclick="showResetDialog()">
                    <i class="fas fa-skull"></i>
                </button>
            </div>
    
            <div class="theme-accordion">
                <div class="accordion-header" onclick="toggleThemes()">
                    <span>Temas</span>
                    <i class="fas fa-chevron-down arrow-icon"></i>
                </div>
                <div class="theme-options">
                    <div class="tema-item" onclick="selectTheme('classico')">
                        <div class="tema-preview classico"></div>
                        <span>Cl√°ssico</span>
                    </div>
                    <div class="tema-item" onclick="selectTheme('new')">
                        <div class="tema-preview new"></div>
                        <span>New</span>
                    </div>
                    <div class="tema-item" onclick="selectTheme('dark')">
                        <div class="tema-preview dark"></div>
                        <span>Dark</span>
                    </div>
                    <div class="tema-item" onclick="selectTheme('blue')">
                        <div class="tema-preview blue"></div>
                        <span>Blue</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="resetDialog" class="reset-dialog">
        <div class="reset-content">
            <div class="reset-header">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>RESET TOTAL</h3>
            </div>
            <p>Tem certeza que deseja apagar todos os dados?</p>
            <div class="reset-buttons">
                <button onclick="cancelReset()">Cancelar</button>
                <button class="confirm-btn" onclick="confirmReset()">Apagar</button>
            </div>
        </div>
    </div>

    <button class="btn-patch" onclick="togglePatches()">
        <i class="fas fa-clipboard-list"></i>
    </button>
    
    <div id="patch-popup" class="patch-popup">
        <div class="patch-header">
            <h3><i class="fas fa-code-branch"></i> Hist√≥rico de atualiza√ß√µes</h3>
            <button class="fechar-popup" onclick="togglePatches()"></button>
        </div>
        <div class="patch-content">
            <div class="patch-item">
                <div class="patch-version">v2.4.4</div>
                <div class="patch-date">24/03/2025</div>
                <ul>
                    <li>Melhorias visuais;</li>
                    <li>"Patch Notes" agora √© "Hist√≥rico de atualiza√ß√µes".</li>
                    <span style="font-size: 9px;">+ novidades em breve!</span>
                </ul>
            </div>
            <div class="patch-item">
                <div class="patch-version">v2.4.3</div>
                <div class="patch-date">23/02/2025</div>
                <ul>
                    <li>Removido o sistema de notifica√ß√µes;</li>
                    <li>Editor de nome com CSS estilizado;</li>
                    <li>Mensagem de vit√≥ria de acordo com o tema;</li>
                    <li>Duplas com cores;</li>
                    <li>Melhorias visuais.</li>
                    <span style="font-size: 9px;">+ novidades em breve!</span>
                </ul>
            </div>
            <div class="patch-item">
                <div class="patch-version">v2.4.2</div>
                <div class="patch-date">22/02/2025</div>
                <ul>
                    <li>Habilitar/desabilitar o hist√≥rico nas configs;</li>
                    <li>Reajuste no sistema de XP;</li>
                    <li>Novo tema azul;</li>
                    <li>Removido tema pro;</li>
                    <li>Melhorias visuais.</li>
                    <span style="font-size: 9px;">+ novidades em breve!</span>
                </ul>
            </div>
            <div class="patch-item">
                <div class="patch-version">v2.4.1</div>
                <div class="patch-date">22/02/2025</div>
                <ul>
                    <li>Tema Dark(antigo Lite);</li>
                    <li>Melhorias visuais;</li>
                    <li>Corre√ß√£o de bugs.</li>
                </ul>
            </div>
            <div class="patch-item">
                <div class="patch-version">v2.4.0</div>
                <div class="patch-date">22/02/2025</div>
                <ul>
                    <li>Melhorias visuais;</li>
                    <li>Sistema de XP reajustado.</li>
                </ul>
            </div>
            <div class="patch-item">
                <div class="patch-version">v2.3.9</div>
                <div class="patch-date">21/02/2025</div>
                <ul>
                    <li>Adi√ß√£o do Patch Notes;</li>
                    <li>Melhorias visuais;</li>
                    <li>Corre√ß√£o de bugs;</li>
                    <li>Quantidade de XP por n√≠vel aumentada.</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="modal-editar-nome" id="modalEditarNome">
        <div class="modal-conteudo">
            <h3>Editar nome</h3>
            <input type="text" id="novoNomeInput" maxlength="10">
            <div class="modal-botoes">
                <button onclick="confirmarEdicao()">Salvar</button>
                <button onclick="fecharModal()">Cancelar</button>
            </div>
        </div>
    </div>
    
    <div class="versao-programa">v2.4.4</div>

    <script>

        function formatarNumero(numero) {
            if (numero == 1000000000) {
        return (numero / 1000000000).toFixed(numero >= 1000000000 ? 0 : 1) + 'Bi'; }
    else if (numero >= 1000000) {
        return (numero / 1000000).toFixed(numero >= 10000000 ? 0 : 1) + 'M';
    } else if (numero >= 1000) {
        return (numero / 1000).toFixed(numero >= 10000 ? 0 : 1) + 'k';
    }
    return numero.toString();
}

        let resetTimer;
        let resetTimeout;
        let desafiosDiarios = [];
        let ultimoDia = null;
        let ultimaAtualizacaoDesafios = null;
        let multiplicadorDiario = 1;

        function toggleDesafios() {
    const popup = document.getElementById('desafios-popup');
    popup.classList.toggle('active');

    if (popup.classList.contains('active')) {
        const agora = new Date();
        const horaAtual = agora.getHours();
        const minutoAtual = agora.getMinutes();

        const horarioLimite = 21;
        const passouDoHorarioLimite = horaAtual > horarioLimite || (horaAtual === horarioLimite && minutoAtual >= 0);

        if (passouDoHorarioLimite) {
            gerarDesafiosDiarios();
        }
    }
}

const possiveisDesafios = [
    { tipo: 'tentos', desc: 'Marque 11 tentos em uma partida', meta: 11, xp: 6500 },
    { tipo: 'tentos', desc: 'Marque 10 tentos em uma partida', meta: 10, xp: 6500 },
    { tipo: 'tentos', desc: 'Marque 9 tentos em uma partida', meta: 9, xp: 5200 },
    { tipo: 'tentos', desc: 'Marque 7 tentos em uma partida', meta: 7, xp: 4800 },
    { tipo: 'tentos', desc: 'Marque 5 tentos em uma partida', meta: 5, xp: 3500 },

    { tipo: 'vitorias', desc: 'Ven√ßa 3 partidas', meta: 3, xp: 10000 },
    { tipo: 'vitorias', desc: 'Ven√ßa 10 partidas', meta: 10, xp: 100000 },
    { tipo: 'vitorias', desc: 'Ven√ßa 5 partidas', meta: 5, xp: 25000 },
    { tipo: 'vitorias', desc: 'Ven√ßa 7 partidas', meta: 7, xp: 45000 },
    { tipo: 'vitorias', desc: 'Ven√ßa 15 partidas', meta: 15, xp: 150000 },
    { tipo: 'vitorias', desc: 'Ven√ßa 20 partidas', meta: 20, xp: 200000 },

    { tipo: 'truco', desc: 'Ative o truco 2 vezes', meta: 2, xp: 5500 },
    { tipo: 'truco', desc: 'Ative o truco 1 vez', meta: 1, xp: 2750 },
    { tipo: 'truco', desc: 'Ative o truco 3 vezes', meta: 3, xp: 8250 },
    { tipo: 'truco', desc: 'Ative o truco 4 vezes', meta: 4, xp: 10000 },
    { tipo: 'truco', desc: 'Ative o truco 5 vezes', meta: 5, xp: 12500 },

    { tipo: 'consecutivas', desc: '2 vit√≥rias consecutivas', meta: 2, xp: 8000 },
    { tipo: 'consecutivas', desc: '4 vit√≥rias consecutivas', meta: 4, xp: 16000 },
    { tipo: 'consecutivas', desc: '6 vit√≥rias consecutivas', meta: 6, xp: 64000 },
    { tipo: 'consecutivas', desc: '8 vit√≥rias consecutivas', meta: 8, xp: 128000 },
    { tipo: 'consecutivas', desc: '10 vit√≥rias consecutivas', meta: 10, xp: 200000 },

    { tipo: 'pontuacao', desc: 'Alcance m√©dia de 4 tentos por partida', meta: 4, xp: 4500 },
    { tipo: 'pontuacao', desc: 'Alcance m√©dia de 5 tentos por partida', meta: 5, xp: 6000 },
    { tipo: 'pontuacao', desc: 'Alcance m√©dia de 6 tentos por partida', meta: 6, xp: 7500 },
    { tipo: 'pontuacao', desc: 'Alcance m√©dia de 7 tentos por partida', meta: 7, xp: 9000 },

    { tipo: 'tentos12', desc: 'Ven√ßa com 12 tentos', meta: 1, xp: 12500 },
    { tipo: 'tentos12', desc: 'Ven√ßa com 12 tentos 2 vezes', meta: 2, xp: 25000 },

    { tipo: 'primeiro', desc: 'Marque o primeiro tento da partida', meta: 1, xp: 3500 },
    { tipo: 'primeiro', desc: 'Marque o primeiro tento em 5 partidas', meta: 5, xp: 15000 },
    { tipo: 'primeiro', desc: 'Marque o primeiro tento em 7 partidas', meta: 7, xp: 15000 },
    { tipo: 'primeiro', desc: 'Marque o primeiro tento em 9 partidas', meta: 9, xp: 15000 },

];

        function gerarDesafiosDiarios() {
            const agora = new Date();
            const horaAtual = agora.getHours();
            const diaAtual = agora.getDate();
            
            const passouDoHorarioLimite = horaAtual >= 21;
            
            const ultimoDiaSalvo = parseInt(localStorage.getItem('ultimoDia')) || 0;
            
            if (diaAtual !== ultimoDiaSalvo || (passouDoHorarioLimite && !localStorage.getItem('desafiosGerados'))) {
                const desafiosSelecionados = new Set();
                const novosDesafios = [];

                while (novosDesafios.length < 3) {
                    const randomIndex = Math.floor(Math.random() * possiveisDesafios.length);
                    const desafio = {...possiveisDesafios[randomIndex]};

                    if (!desafiosSelecionados.has(desafio.tipo)) {
                        desafio.progresso = 0;
                        desafio.completo = false;
                        novosDesafios.push(desafio);
                        desafiosSelecionados.add(desafio.tipo);
                    }
                }

                localStorage.setItem('desafiosDiarios', JSON.stringify(novosDesafios));
                localStorage.setItem('ultimoDia', diaAtual.toString());
                localStorage.setItem('desafiosGerados', 'true');
                desafiosDiarios = novosDesafios;
                
                if (diaAtual !== ultimoDiaSalvo) {
                    multiplicadorDiario = 1;
                    localStorage.setItem('multiplicadorDiario', multiplicadorDiario);
                }
            }
            else {
                desafiosDiarios = JSON.parse(localStorage.getItem('desafiosDiarios')) || [];
            }

            multiplicadorDiario = parseInt(localStorage.getItem('multiplicadorDiario')) || 1;
            atualizarUIDesafios();
            iniciarContagemRegressiva();
        }

        function verificarProgressoDesafios(tipo, quantidade = 1) {
    let desafiosCompletos = 0;
    
    desafiosDiarios.forEach(desafio => {
        if(!desafio.completo && desafio.tipo === tipo) {
            const pontosReais = trucoAtivo ? quantidade * trucoTento : quantidade;
            desafio.progresso += pontosReais;
            
            if(desafio.progresso >= desafio.meta) {
                desafio.completo = true;
                const xpBonus = Math.floor(desafio.xp * multiplicadorDiario);
                adicionarXP('dupla1', xpBonus);
                desafiosCompletos++;
                
                mostrarNotificacao(`Desafio completo! +${xpBonus} XP`, '#4CAF50');
                vibrar(200);
            }
        }
    });

    if(desafiosCompletos === 3) {
        multiplicadorDiario += 0.5;
        localStorage.setItem('multiplicadorDiario', multiplicadorDiario);
        mostrarNotificacao(`Multiplicador aumentado para ${multiplicadorDiario}x!`, '#FFD700');
    }

    localStorage.setItem('desafiosDiarios', JSON.stringify(desafiosDiarios));
    atualizarUIDesafios();
}

function atualizarUIDesafios() {
    const container = document.getElementById('desafios-list');
    container.innerHTML = '';
    
    desafiosDiarios.forEach((desafio, index) => {
        const progresso = Math.min(desafio.progresso, desafio.meta);
        const porcentagem = (progresso / desafio.meta) * 100;
        const icone = desafio.completo ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-running"></i>';
        const xpComMultiplicador = Math.floor(desafio.xp * multiplicadorDiario);

        container.innerHTML += `
            <div class="desafio-item ${desafio.completo ? 'completo' : ''}">
                <div class="desafio-info">
                    ${icone}
                    <span class="desafio-desc">${desafio.desc}</span>
                    <span class="desafio-xp">+${xpComMultiplicador}XP</span>
                </div>
                <div class="progresso-bar">
                    <div class="progresso" style="width: ${porcentagem}%"></div>
                    <span class="progresso-texto">${progresso}/${desafio.meta}</span>
                </div>
                ${!desafio.completo ? `
                    <div class="multiplicador-indicator">
                        ${multiplicadorDiario}x
                    </div>
                ` : ''}
            </div>
        `;
    });
}

        function iniciarContagemRegressiva() {
    const timerElement = document.getElementById('timer-desafios');
    
    const updateTimer = () => {
        const agora = new Date();
        const proximaAtualizacao = new Date();
        
        if(agora.getHours() >= 21) {
            proximaAtualizacao.setDate(proximaAtualizacao.getDate() + 1);
        }
        proximaAtualizacao.setHours(21, 0, 0, 0);

        const diff = proximaAtualizacao - agora;
        const horas = Math.floor(diff / 3600000);
        const minutos = Math.floor((diff % 3600000) / 60000);
        const segundos = Math.floor((diff % 60000) / 1000);

        timerElement.innerHTML = `
            ${String(horas).padStart(2, '0')}h 
            ${String(minutos).padStart(2, '0')}m 
            ${String(segundos).padStart(2, '0')}s
        `;

        if(diff <= 0 && !timerElement.classList.contains('updating')) {
            timerElement.classList.add('updating');
            gerarDesafiosDiarios();
            setTimeout(() => timerElement.classList.remove('updating'), 1000);
        }
    };

    setInterval(updateTimer, 1000);
    updateTimer();
}

function vibrar(duracao) {
    if(navigator.vibrate) {
        navigator.vibrate(duracao);
    }
}

        let tentosAleatorios;

        let desafioTentosConcedido = {
            dupla1: false,
            dupla2: false
        };

        let desafioPrimeiroConcedido = {
            dupla1: false,
            dupla2: false
        };

        let pontosUltimasPartidas = {
            dupla1: [],
            dupla2: []
        };

        let vitoriasConsecutivas = 0;

        let tentos = {
            dupla1: 0,
            dupla2: 0
        };

        let vitorias = {
            dupla1: 0,
            dupla2: 0
        };

        let trucoTento = 0;
        let trucoAtivo = false;
        let historico = [];

        let nomesDuplas = {
    dupla1: "N√ìS",
    dupla2: "ELES"
};

let xpData = {
            dupla1: { xp: 0, level: 0 },
            dupla2: { xp: 0, level: 0 }
        };

        function calcularXPNecessario(level) {
    return Math.floor(500 * Math.pow(level, 3) + 1000 + level * 100);
}

        function mostrarTooltip(dupla) {
    const vitoriasDupla = vitorias[dupla];
    let rankAtual = ranks[0];
    
    for (let i = ranks.length - 1; i >= 0; i--) {
        if (vitoriasDupla >= ranks[i].min) {
            rankAtual = ranks[i];
            break;
        }
    }

    const tooltipElement = document.getElementById(`${dupla}-tooltip`);
    tooltipElement.textContent = `${rankAtual.name}`;
}

        function adicionarXP(dupla, xpGanho) {
            xpData[dupla].xp += xpGanho;
    while (xpData[dupla].xp >= calcularXPNecessario(xpData[dupla].level)) {
        xpData[dupla].xp -= calcularXPNecessario(xpData[dupla].level);
        xpData[dupla].level++;
    }

            if (vitoriasConsecutivas > 0) {
        const bonus = Math.floor(xpGanho * (vitoriasConsecutivas * 0.1));
        xpData[dupla].xp += bonus;
    }

            salvarXPData();
            atualizarBarraXP(dupla);
        }

        setInterval(updateChallengeTimer, 1000);
        updateChallengeTimer();

        function calcularMediaPontos(dupla) {
    const pontos = pontosUltimasPartidas[dupla];
    const soma = pontos.reduce((a, b) => a + b, 0);
    return soma / pontos.length;
}

        function atualizarBarraXP(dupla) {
            const currentLevel = xpData[dupla].level;
            const currentXP = xpData[dupla].xp;
            const requiredXP = calcularXPNecessario(currentLevel);
            const porcentagem = (currentXP / requiredXP) * 100;

            document.getElementById(`${dupla}-xp-bar`).style.width = `${porcentagem}%`;
            const xpTextElement = document.getElementById(`${dupla}-xp-text`);
     xpTextElement.textContent = `${formatarNumero(currentXP)} / ${formatarNumero(requiredXP)} XP`;
            document.getElementById(`${dupla}-level`).textContent = `Lv ${currentLevel}`;
        }

        function salvarXPData() {
            localStorage.setItem('xpData', JSON.stringify(xpData));
        }

        function carregarXPData() {
            const savedData = localStorage.getItem('xpData');
            if (savedData) {
                xpData = JSON.parse(savedData);
                atualizarBarraXP('dupla1');
                atualizarBarraXP('dupla2');
            }
        }

        let duplaAtualEditando = '';

function editarNome(dupla) {
    duplaAtualEditando = dupla;
    const modal = document.getElementById('modalEditarNome');
    const input = document.getElementById('novoNomeInput');
    input.value = nomesDuplas[dupla];
    modal.style.display = 'flex';
    input.focus();
}

document.getElementById('modalEditarNome').addEventListener('click', function(e) {
    if (e.target === this) {
        fecharModal();
    }
});

function confirmarEdicao() {
    const novoNome = document.getElementById('novoNomeInput').value.trim();
    if (novoNome) {
        nomesDuplas[duplaAtualEditando] = novoNome.substring(0, 10);
        document.getElementById(`${duplaAtualEditando}-nome`).textContent = nomesDuplas[duplaAtualEditando];
        salvarNomes();
        
        const msgac = document.getElementById("msgac");
        msgac.innerHTML = `<i class="fas fa-check-circle"></i> Nome alterado`;
        msgac.classList.add("show");
        
        setTimeout(() => {
            msgac.classList.remove("show");
        }, 3000);
    }
    fecharModal();
}

function fecharModal() {
    document.getElementById('modalEditarNome').style.display = 'none';
    duplaAtualEditando = '';
}

function salvarNomes() {
    localStorage.setItem('nomesDuplas', JSON.stringify(nomesDuplas));
}

function carregarNomes() {
    const nomesSalvos = JSON.parse(localStorage.getItem('nomesDuplas'));
    if (nomesSalvos) {
        nomesDuplas = nomesSalvos;
        document.getElementById('dupla1-nome').textContent = nomesDuplas.dupla1;
        document.getElementById('dupla2-nome').textContent = nomesDuplas.dupla2;
    }
}

        function carregarVitorias() {
            const vitoriasSalvas = JSON.parse(localStorage.getItem('vitorias')) || {dupla1: 0, dupla2: 0};
            vitorias.dupla1 = vitoriasSalvas.dupla1;
            vitorias.dupla2 = vitoriasSalvas.dupla2;
            document.getElementById('dupla1-vitorias').textContent = vitorias.dupla1;
            document.getElementById('dupla2-vitorias').textContent = vitorias.dupla2;
        }

        function salvarVitorias() {
            localStorage.setItem('vitorias', JSON.stringify(vitorias));
        }

        function salvarHistorico() {
            localStorage.setItem('historico', JSON.stringify(historico));
        }

        function carregarHistorico() {
            historico = JSON.parse(localStorage.getItem('historico')) || [];
            mostrarHistorico();
        }

        function verificarDesafio(dupla) {
    let xpDesafio = 0;
    
    if (!desafioTentosConcedido[dupla] && tentos[dupla] > tentosAleatorios) {
    xpDesafio += Math.floor(Math.random() * (5000 - 2000 + 1)) + 3000;
    desafioTentosConcedido[dupla] = true;
}
    
    if (trucoAtivo && tentos[dupla] === 11) {
        xpDesafio += Math.floor(Math.random() * (8000 - 3000 + 1)) + 3000;
    }

    if (xpDesafio > 0) {
        adicionarXP(dupla, xpDesafio);
        atualizarHistorico(`A dupla ${nomesDuplas[dupla]} completou um desafio e recebeu ${xpDesafio} XP!`);
    }
}

        function verificarAtualizacaoDesafios() {
            const agora = new Date();
            const ultimaAtualizacao = localStorage.getItem('ultimaAtualizacaoDesafios');
            
            if (!ultimaAtualizacao || new Date(ultimaAtualizacao).getDate() !== agora.getDate()) {
                gerarDesafiosDiarios();
                localStorage.setItem('ultimaAtualizacaoDesafios', agora.toISOString());
            }
        }

        function incrementarPontos(dupla) {
            let pontosAdicionados = trucoAtivo ? trucoTento : 1;
            tentos[dupla] += pontosAdicionados;
            document.getElementById(`${dupla}-tentos`).textContent = tentos[dupla];

            if (!desafioPrimeiroConcedido[dupla] && tentos[dupla] >= 1) {
        verificarProgressoDesafios('primeiro', 1);
        desafioPrimeiroConcedido[dupla] = true;
    }

    const baseAleatoria = Math.floor(Math.random() * (5000 - 3000 + 1)) + 3000;
const baseVitoriaXP = baseAleatoria * 12;
const bonusConsecutivo = vitoriasConsecutivas * 1000;
const multiplicadorTruco = trucoAtivo ? (trucoTento === 3 ? 1 : trucoTento / 3) : 1;

vitoriaXP = Math.round((baseVitoriaXP + bonusConsecutivo) * multiplicadorTruco);

            const baseXPporTento = 1000;
    const bonusXP = Math.floor(Math.random() * 750);
    const xpPorTento = baseXPporTento + bonusXP;
    
    pontosAdc = xpPorTento * pontosAdicionados;

            verificarDesafio(dupla);

            if (!desafioTentosConcedido[dupla] && tentos[dupla] > tentosAleatorios) {
        pontosAdc += Math.floor(Math.random() * (5500 - 2000 + 1)) + 2000;
        desafioTentosConcedido[dupla] = true;
    }

    pontosUltimasPartidas[dupla].push(pontosAdicionados);
    if (pontosUltimasPartidas[dupla].length > 5) {
        pontosUltimasPartidas[dupla].shift();
    }

    const mediaPontos = calcularMediaPontos(dupla);

    if (pontosAdicionados > mediaPontos) {
        pontosAdc += 1000;
    }

            adicionarXP(dupla, pontosAdc);

            atualizarHistorico(`${nomesDuplas[dupla]} marcou ${pontosAdicionados} tento${pontosAdicionados > 1 ? 's' : ''} (+${pontosAdc} XP).`);

            if (tentos[dupla] === 11) {
                atualizarHistorico(`${nomesDuplas[dupla]} disse: M√ÉO DE ONZE! SE EMPATAR √â NO ESCURINHO!`);
            }

            verificarProgressoDesafios('tentos', pontosAdicionados);
            if (tentos[dupla] >= 12) {
                verificarProgressoDesafios('tentos12');
                exibirMensagemVitoria(dupla);
                adicionarXP(dupla, vitoriaXP);
                vitoriasConsecutivas++;
                vitorias[dupla]++;
                document.getElementById(`${dupla}-vitorias`).textContent = vitorias[dupla];
                salvarVitorias();
                atualizarHistorico(`${nomesDuplas[dupla]} venceu a partida! (+${vitoriaXP} XP)`, true);
                verificarProgressoDesafios('vitorias', 1);

                if (calcularMediaPontos(dupla) >= 4) {
            verificarProgressoDesafios('pontuacao', 1);
        }

                resetarTentos();
            } else {
                vitoriasConsecutivas = 0;
            }

            if(vitoriasConsecutivas > 0) {
    verificarProgressoDesafios('consecutivas', vitoriasConsecutivas);
}
            resetarTruco();

            atualizarRank(dupla);
        }

        function decrementarPontos(dupla) {
            if (tentos[dupla] > 0) {
                tentos[dupla] -= (trucoAtivo ? trucoTento : 1);
                if (tentos[dupla] < 0) tentos[dupla] = 0;
                document.getElementById(`${dupla}-tentos`).textContent = tentos[dupla];
                atualizarHistorico(`${nomesDuplas[dupla]} - 1 tento.`);
            }
        }

        function ativarTruco() {
            if (!trucoAtivo) {
                trucoAtivo = true;
                trucoTento = 3;
                atualizarHistorico(`√â TRUUUCO, LADR√ÉO!`);
            } else if (trucoTento === 3) {
                trucoTento = 6;
                atualizarHistorico(`SEEEEEEEEEEIS, MARRECO!`);
            } else if (trucoTento === 6) {
                trucoTento = 9;
                atualizarHistorico(`NOVEEEEEEEEEEEEE PATOOO! VAI CORRER?!`);
            } else if (trucoTento === 9) {
                trucoTento = 12;
                atualizarHistorico(`√â DOZE AQUI ENT√ÉO, TIOZ√ÉO!`);
            } else {
                trucoAtivo = false;
                trucoTento = 0;
                atualizarHistorico(`Truco off.`);
            }
            document.getElementById('truco-pontos').textContent = trucoTento;

            verificarProgressoDesafios('truco');
        }

        function exibirMensagemVitoria(dupla) {
    const mensagem = document.getElementById('mensagem-vitoria');
    const ganhador = document.getElementById('ganhador');
    mensagem.style.animation = 'aparecer 0.5s ease-out';

    setTimeout(() => {
        adicionarXP(dupla, vitoriaXP);
        atualizarRank(dupla);
    }, 100);
    
    const placar = `${nomesDuplas.dupla1} ${tentos.dupla1} x ${tentos.dupla2} ${nomesDuplas.dupla2}`;
    ganhador.innerHTML = `
        ${placar}<br>
        <span style="font-size: 19px; color: #bc0000;">${nomesDuplas[dupla]} Venceu!</span>
    `;
    
    mensagem.style.display = 'block';
}

        function atualizarHistorico(acao, salvarPlacar = false) {
            const now = new Date();
            const dataHora = now.toLocaleString('pt-BR');

            if (acao.includes('marcou')) {
        acao = `<span style="color: #66b266;">${acao}</span>`;
    } else if (acao.includes('desceu')) {
        acao = `<span style="color: #e06666;">${acao}</span>`;
    } else if (acao.includes('venceu')) {
        acao = `<span style="color: #e1c66c;">${acao}</span>`;
    } else if (acao.includes('recebeu')) {
        acao = `<span style="color: cyan;">${acao}</span>`;
    } else if (acao.includes('completo:')) {
        acao = `<span style="color: purple;">${acao}</span>`;
    }

            if (salvarPlacar) {
        acao += ` | Placar final: ${nomesDuplas.dupla1} ${tentos.dupla1} x ${tentos.dupla2} ${nomesDuplas.dupla2}`;
    }
            historico.push(`${dataHora}: ${acao}`);
            salvarHistorico();
    
        if (document.getElementById('historico-container').style.display === 'block') {
            mostrarHistorico();
            }
        }

        function mostrarHistorico() {
            const historicoContainer = document.getElementById('historico-container');
            historicoContainer.innerHTML = `
            <button class="limpar-historico-btn" onclick="limparHistorico()"><i class="fas fa-trash-alt"></i></button>
            ${historico.map(entry => `<p>${entry}</p>`).join('')}
        `;
        historicoContainer.style.display = 'block'; 
        }

        function limparHistorico() {
            historico = [];
            localStorage.removeItem('historico'); 
            mostrarHistorico();
        }

        function toggleHistorico() {
    const historicoContainer = document.getElementById('historico-container');
    if (historicoContainer.style.display === 'block') {
        historicoContainer.style.display = 'none';
    } else {
        historicoContainer.style.display = 'block';
        mostrarHistorico();
    }
}

        function resetarTentos() {
            tentosAleatorios = Math.floor(Math.random() * 5) + 3;
            tentos.dupla1 = 0;
            tentos.dupla2 = 0;
            document.getElementById('dupla1-tentos').textContent = 0;
            document.getElementById('dupla2-tentos').textContent = 0;
            resetarTruco();

            desafioTentosConcedido.dupla1 = false;
            desafioTentosConcedido.dupla2 = false;
            desafioPrimeiroConcedido.dupla1 = false;
            desafioPrimeiroConcedido.dupla2 = false;
        }

        function reiniciarJogo() {
            resetarTentos();
            document.getElementById('mensagem-vitoria').style.display = 'none';

            verificarProgressoDesafios('reiniciar', 1);
        }

        function resetarTruco() {
            trucoAtivo = false;
            trucoTento = 0;
            document.getElementById('truco-pontos').textContent = trucoTento;
        }

        window.onload = function() {
            carregarVitorias();
            carregarHistorico();
            carregarNomes();
            carregarXPData();
            atualizarRank('dupla1');
            atualizarRank('dupla2');
            loadTheme();
            loadCheckboxState();
            iniciarContagemRegressiva();
            gerarDesafiosDiarios();
            tentosAleatorios = Math.floor(Math.random() * 5) + 3; 
            document.getElementById('historico-container').style.display = 'none';
            const agora = new Date();
            const horaAtual = agora.getHours();
            const minutoAtual = agora.getMinutes();

    const horarioLimite = 20;
    const passouDoHorarioLimite = horaAtual > horarioLimite || (horaAtual === horarioLimite && minutoAtual >= 0);

    if (passouDoHorarioLimite) {
        gerarDesafiosDiarios();
    }

    ultimoDia = parseInt(localStorage.getItem('ultimoDia')) || new Date().getDate();
    desafiosDiarios = JSON.parse(localStorage.getItem('desafiosDiarios')) || [];
    atualizarUIDesafios();
            document.querySelector('.historico-btn').style.display = 
            localStorage.getItem('mostrarHistorico') === 'true' ? 'block' : 'none';

            setInterval(() => {
                const agora = new Date();
                if(agora.getMinutes() === 0) {
                    gerarDesafiosDiarios();
                }
            }, 60000);
        };

        const ranks = [
    { name: "Bronze I", min: 0, color: "#cd7f32" },
    { name: "Bronze II", min: 5, color: "#b87333" },
    { name: "Bronze III", min: 10, color: "#a65e2e" },
    { name: "Prata I", min: 20, color: "#C0C0C0" }, 
    { name: "Prata II", min: 30, color: "#A9A9A9" },
    { name: "Prata III", min: 40, color: "#808080" },
    { name: "Ouro I", min: 50, color: "#ffd700" },
    { name: "Ouro II", min: 60, color: "#ffdf00" },
    { name: "Ouro III", min: 70, color: "#ffec00" },
    { name: "Diamante I", min: 90, color: "#b9f2ff" },
    { name: "Diamante II", min: 100, color: "#a0e6ff" },
    { name: "Diamante III", min: 110, color: "#7ed4f7" },
    { name: "M√≠tico I", min: 120, color: "#8a2be2" },
    { name: "M√≠tico II", min: 135, color: "#6c1db6" },
    { name: "M√≠tico III", min: 150, color: "#560b9d" },
    { name: "Mestre I", min: 225, color: "#ff2020" },
    { name: "Mestre II", min: 335, color: "#be0000" },
    { name: "PRO", min: 400, color: "#ccff33" }
];

function atualizarRank(dupla) {
    const vitoriasDupla = vitorias[dupla];
    let rankAtual = ranks[0];
    
    for (let i = ranks.length - 1; i >= 0; i--) {
        if (vitoriasDupla >= ranks[i].min) {
            rankAtual = ranks[i];
            break;
        }
    }

    const medalIcon = document.querySelector(`.rank-icon.${dupla === 'dupla1' ? 'left' : 'right'} i`);
    medalIcon.className = `fa-solid fa-medal ${rankAtual.name.toLowerCase().replace(/\s/g, '-')}`;
    medalIcon.style.color = rankAtual.color;
    
    const levelElement = document.getElementById(`${dupla}-level`);
    levelElement.style.backgroundColor = rankAtual.color;
    levelElement.title = `Rank: ${rankAtual.name}`;
    
    levelElement.classList.remove("pro-rank", "mestre1-rank", "mestre2-rank");
    
    if (rankAtual.name === "PRO") {
        levelElement.classList.add("pro-rank");
    } else if (rankAtual.name === "Mestre I") {
        levelElement.classList.add("mestre1-rank");
    } else if (rankAtual.name === "Mestre II") {
        levelElement.classList.add("mestre2-rank");
    } else {
        levelElement.style.backgroundColor = rankAtual.color;
        levelElement.style.boxShadow = `0 0 5px ${rankAtual.color}50`;
    }
    
    const duplaContainer = levelElement.closest('.dupla');
    const rankingIcon = levelElement.closest('.level-bar').querySelector('.rank-icon i.fa-medal');
    
    rankingIcon.classList.remove("pro-rank", "mestre1-rank", "mestre2-rank", "ouro", "diamante", "mitico", "prata", "bronze");
    
    if (rankAtual.name.includes("PRO")) {
        rankingIcon.classList.add("pro-rank");
    } else if (rankAtual.name.includes("Mestre I")) {
        rankingIcon.classList.add("mestre1-rank");
    } else if (rankAtual.name.includes("Mestre II")) {
        rankingIcon.classList.add("mestre2-rank");
    } else if (rankAtual.name.includes("Ouro")) {
        rankingIcon.classList.add("ouro");
    } else if (rankAtual.name.includes("Diamante")) {
        rankingIcon.classList.add("diamante");
    } else if (rankAtual.name.includes("M√≠tico")) {
        rankingIcon.classList.add("mitico");
    } else if (rankAtual.name.includes("Prata")) {
        rankingIcon.classList.add("prata");
    } else {
        rankingIcon.classList.add("bronze");
    }
    
    const tooltipElement = document.getElementById(`${dupla}-tooltip`);
    tooltipElement.textContent = `${rankAtual.name}`;
}


function updateChallengeTimer() {
    const now = new Date();
    const target = new Date();
if (now.getHours() >= 21) {
    target.setDate(target.getDate() + 1);
}
target.setHours(21, 0, 0, 0);

    const diff = target - now;
    const hours = Math.floor(diff / 3600000);
    const minutes = Math.floor((diff % 3600000) / 60000);
    const seconds = Math.floor((diff % 60000) / 1000);

    document.getElementById('timer-desafios').textContent = 
        `${String(hours).padStart(2, '0')}h${String(minutes).padStart(2, '0')}m${String(seconds).padStart(2, '0')}s`;
}

function loadTheme() {
    const savedTheme = localStorage.getItem('theme') || 'new';
    document.body.setAttribute('data-theme', savedTheme);
}

function selectTheme(theme) {
    document.body.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    toggleSettings();
}

function toggleSettings() {
    const popup = document.getElementById('config-popup');
    popup.classList.toggle('active');
}

loadTheme();

function loadCheckboxState() {
    document.getElementById('historico-check').checked = localStorage.getItem('mostrarHistorico') === 'true';
atualizarVisibilidadeHistorico();
}

function atualizarVisibilidadeHistorico() {
    const mostrar = localStorage.getItem('mostrarHistorico') === 'true';
    const btnHistorico = document.querySelector('.historico-btn');
    const containerHistorico = document.getElementById('historico-container');
    
    btnHistorico.style.display = mostrar ? 'block' : 'none';
    containerHistorico.style.display = 'none'; 
}

document.getElementById('historico-check').addEventListener('change', function() {
    localStorage.setItem('mostrarHistorico', this.checked);
    atualizarVisibilidadeHistorico();
});

let themesOpen = false;

function toggleThemes() {
    const options = document.querySelector('.theme-options');
    const arrow = document.querySelector('.arrow-icon');
    
    themesOpen = !themesOpen;
    options.classList.toggle('open');
    arrow.classList.toggle('rotated');
}

function showResetDialog() {
    const dialog = document.getElementById('resetDialog');
    const progress = document.getElementById('resetProgress');
    dialog.style.display = 'block';
    
    let seconds = 10;
    resetTimer = setInterval(() => {
        seconds--;
        progress.style.width = `${(10 - seconds) * 10}%`;
        if(seconds <= 0) confirmReset();
    }, 1000);
}

function cancelReset() {
    clearInterval(resetTimer);
    document.getElementById('resetDialog').style.display = 'none';
}

function confirmReset() {
    const desafiosSalvos = localStorage.getItem('desafiosDiarios');
    const ultimoDiaSalvo = localStorage.getItem('ultimoDia');

    if(ultimoDiaSalvo) {
        localStorage.setItem('ultimoDia', ultimoDiaSalvo);
    }

    localStorage.clear();
    location.reload();
}

function togglePatches() {
    const popup = document.getElementById('patch-popup');
    popup.classList.toggle('active');
}

    </script>
</body>
</html>
